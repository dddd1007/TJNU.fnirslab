{
    "collab_server" : "",
    "contents" : "#\n#                       _oo0oo_\n#                      o8888888o\n#                      88\" . \"88\n#                      (| -_- |)\n#                      0\\  =  /0\n#                    ___/`---'\\___\n#                  .' \\\\|     |# '.\n#                 / \\\\|||  :  |||# \\\n#                / _||||| -:- |||||- \\\n#               |   | \\\\\\  -  #/  |   |\n#               | \\_|  ''\\---/''  |_/ |\n#               \\  .-\\__  '-'  ___/-. /\n#             ___'. .'  /--.--\\  `. .'___\n#          .\"\" '<  `.___\\_<|>_/___.' >' \"\".\n#         | | :  `- \\`.;`\\ _ /`;.`/ - ` : | |\n#         \\  \\ `_.   \\_ __\\ /__ _/   .-` /  /\n#     =====`-.____`.___ \\_____/___.-`___.-'=====\n#                       `=---='\n#\n#\n#     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n#\n#               佛祖保佑         永无BUG\n#\n# 天津师范大学 心理与行为研究院 近红外组\n# 夏骁凯 编写\n# 有问题请联系 dddd1007@gmail.com\n\nspm_convert <- function(filename){\n\n  #读取数据\n  datafile <- readr::read_delim(filename, \"\\t\", escape_double = FALSE, trim_ws = TRUE,\n                         skip = 36, col_names = FALSE)\n\n  #生成确定行列的数据框\n  rownum <- nrow(datafile)\n  colnum <- (ncol(datafile)-4)/3\n  oxyData <- as.data.frame(matrix(ncol = colnum, nrow = rownum))\n  dxyData <- as.data.frame(matrix(ncol = colnum, nrow = rownum))\n  tHbData <- as.data.frame(matrix(ncol = colnum, nrow = rownum))\n  time <- datafile[,1]\n\n  #循环分类取出氧合血红蛋白、脱氧血红蛋白、总血红蛋白变化\n  for (i in 1 : colnum) {\n    oxyData[,i] <- datafile[,(i*3)+2]\n    dxyData[,i] <- datafile[,(i*3)+3]\n    tHbData[,i] <- datafile[,(i*3)+4]\n  }\n\n  #取出其他部分的数据\n  vector_onset <- datafile[,2]        #onset点数据\n  fs <- 1/(mean(diff(unlist(time ,use.names = FALSE))))  #计算采样率\n  nch <- (ncol(datafile)-4)/3         #通道数\n  T <- 1/fs                           #我也不知道是什么鬼\n\n  #将数据转换成矩阵\n  oxyData <- as.matrix(oxyData)\n  dxyData <- as.matrix(dxyData)\n  tHbData <- as.matrix(tHbData)\n  vector_onset <- as.numeric(unlist(vector_onset, use.names = FALSE))\n\n  #将数据整合为列表\n  nirs_data <- list(oxyData = oxyData, dxyData = dxyData, tHbData = tHbData,\n                    fs = fs, nch = nch, T = T, vector_onset = vector_onset)\n\n  #提取文件名\n  myfilename <- stringr::str_sub(filename, start = 1, end = -5)\n  myfilename <- stringr::str_c(myfilename, \"mat\", sep = \".\")\n  #生成Mat文件\n  R.matlab::writeMat(myfilename, nirs_data = nirs_data)\n}\n",
    "created" : 1479722917547.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "829614592",
    "id" : "B713E183",
    "lastKnownWriteTime" : 1479799313,
    "last_content_update" : 1479799313133,
    "path" : "~/Documents/Code/TJNU.fnirslab/R/convertfile/spm_convert.R",
    "project_path" : "R/convertfile/spm_convert.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}